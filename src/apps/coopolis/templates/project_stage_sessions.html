{% extends "base.html" %}
{% load static %}

{% block home_is_active %}{% endblock %}
{% block enrollments_is_active %}{% endblock %}
{% block projects_is_active %}is-active{% endblock %}

{% block content %}
{% include './components/header_topbar.html' %}
    {% if is_draft %}
    <div class="grid-item-wide project__intro-banner">
    <div class="text-md is-bold">
    <p>Sol·licitud pendent:</p>
    </div>
    <div>
    <p>Tens una demanda d'acompanyament sense acabar. Pots tornar a l'esborrany per finalitzar el procés i enviar la sol·licitud.</p>
    </div>
        <div class="action-text">
            <form action="" method="post">
                {% csrf_token %}
                <button type="submit" name="delete" value="{{ project.pk }}">Eliminar esborrany</button>
            </form>
        </div>
        <a href="{% url 'project_stage_start' pk=project.id %}">
            <div class="btn btn--second">
                <div class="btn__text">
                    <p>Continuar</p>
                </div>
            </div>
        </a>
    </div>
    {% elif is_pending %}
    <div class="grid-item-wide project__intro-banner">
    <div class="text-md is-bold">
    <p>Acompanyament obert:</p>
    </div>
    <div>
    <p>Tens una demanda d'acompanyament obert. En breus ens posarem en contacte amb tu.</p>
    </div>
    </div>
    {% elif not is_open %}
    <div class="grid-item-wide project__intro-btn title-2">
    <a href="{% url 'project_stage_start' pk=project.id %}">
        <div class="btn btn--second">
            <div class="btn__text">
                <p>Sol·licitar acompanyament</p>
            </div>
        </div>
    </a>
    </div>
    {% endif %}
    <h1>{{ project.name }}</h1>
    <p>Estat del projecte: {{ project.get_project_status_display }}</p>
    <p>Orígens del projecte: {{ project.project_origins }}</p>
    <p>Quines necessitats resol el vostre projecte?: {{ project.solves_necessities }}</p>
    <p>Compta el vostre projecte amb una base social?:{{ project.social_base }}</p>
    {% for project_stage in project.stages.all %}
        {% if project_stage.stage_state != "PENDING" %}
            <h2>Acompanyaments:</h2>
            <h1>{{ project_stage.get_stage_type_display }}</h1>
            <h1>{{ project_stage.date_start }}</h1>
            {% for stage_session in project_stage.stage_sessions.all %}
                <h2>{{ project_stage.stage_sessions.count }} Sessions</h2>
                <p>{{ stage_session.date }}</p>
                <p>{{ stage_session.objective }}</p>
                <p>{{ stage_session.result }}</p>
                <p>Material adjunt:</p>
                <p>{{ stage_session.file1 }}</p>
                <p>{{ stage_session.file2 }}</p>
                <p>{{ stage_session.file3 }}</p>
            {% endfor %}
        {% endif %}
    {% endfor %}
    {% if messages %}
    <div class="modal">
      <div class="modal__background" onclick="hideModal(event)"></div>
      <div class="modal__card">
        <div class="modal__title title-1">
          <p>Confirmació d'enviament de l'enquesta</p>
        </div>
        <div class="modal__close" onclick="hideModal(event)">
          <svg
            class="icon-pathfill-primary"
            xmlns="http://www.w3.org/2000/svg"
            viewbox="0 0 9.46 9.46">
            <path
              d="M 0.73,9.46 0,8.73 4,4.73 0,0.73 0.73,0 l 4,4 4,-4 0.73,0.73 -4,4 4,4 -0.73,0.73 -4,-4 z" />
          </svg>
        </div>
        <div class="modal__form form">
          <div class="modal__intro text-md">
            {% for message in messages %}
            <div class="text-md">
              <p>{{ message }}</p>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
{% endblock %}